!function t(e,a,r){function o(l,n){if(!a[l]){if(!e[l]){var i="function"==typeof require&&require;if(!n&&i)return i(l,!0);if(s)return s(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var u=a[l]={exports:{}};e[l][0].call(u.exports,function(t){var a=e[l][1][t];return o(a?a:t)},u,u.exports,t,e,a,r)}return a[l].exports}for(var s="function"==typeof require&&require,l=0;l<r.length;l++)o(r[l]);return o}({"/Users/thadk/gitrepos/oc-map/app/assets/scripts/components/dropdown.js":[function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var o=t("react"),s=r(o),l=s["default"].createClass({displayName:"Dropdown",propTypes:{className:s["default"].PropTypes.string,triggerTitle:s["default"].PropTypes.string,triggerClassName:s["default"].PropTypes.string,triggerText:s["default"].PropTypes.string,closeDropdown:s["default"].PropTypes.func,children:s["default"].PropTypes.node},_bodyListener:function(t){var e=t.target;if("HTML"===e.tagName||"BODY"===e.tagName||"dropdown:close"===e.getAttribute("data-hook"))return void this.setState({open:!1});do{if(e&&"dropdown"===e.getAttribute("data-hook"))break;e=e.parentNode}while(e&&"BODY"!==e.tagName);e!==this.refs.dropdown&&this.setState({open:!1})},getDefaultProps:function(){return{element:"div",className:"",triggerTitle:"",triggerClassName:"",triggerText:""}},getInitialState:function(){return{open:!1}},componentDidMount:function(){window.addEventListener("click",this._bodyListener)},componentWillUnmount:function(){window.removeEventListener("click",this._bodyListener)},_toggleDropdown:function(t){t.preventDefault(),this.setState({open:!this.state.open})},render:function(){var t=["drop"];return this.state.open&&t.push("drop--open"),this.props.className&&t.push(this.props.className),s["default"].createElement(this.props.element,{className:t.join(" "),"data-hook":"dropdown",ref:"dropdown"},s["default"].createElement("a",{href:"#",title:this.props.triggerTitle,className:this.props.triggerClassName,onClick:this._toggleDropdown},s["default"].createElement("span",null,this.props.triggerText)),s["default"].createElement("div",{className:"drop__content"},this.props.children))}});e.exports=l},{react:"react"}],"/Users/thadk/gitrepos/oc-map/app/assets/scripts/main.js":[function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}t("babel-polyfill");var o=t("react"),s=r(o),l=t("react-dom"),n=t("./views/map-widget"),i=r(n),c=t("./views/table-widget"),u=r(c);window.OC_MAP={initMapWidget:function(t){(0,l.render)(s["default"].createElement(i["default"],null),t)},initTableWidget:function(t){(0,l.render)(s["default"].createElement(u["default"],null),t)}}},{"./views/map-widget":"/Users/thadk/gitrepos/oc-map/app/assets/scripts/views/map-widget.js","./views/table-widget":"/Users/thadk/gitrepos/oc-map/app/assets/scripts/views/table-widget.js","babel-polyfill":"babel-polyfill",react:"react","react-dom":"react-dom"}],"/Users/thadk/gitrepos/oc-map/app/assets/scripts/views/map-widget.js":[function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var o=t("isomorphic-fetch"),s=r(o),l=t("bluebird"),n=r(l),i=t("react"),c=r(i),u=t("leaflet"),d=r(u),p=t("classnames"),f=r(p),h=t("lodash"),m=r(h),y=t("leaflet-omnivore"),g=r(y),w=t("../components/dropdown"),v=r(w),b=t("leaflet-search"),S=(r(b),t("turf-bbox-polygon")),C=r(S),_=t("turf-centroid"),E=r(_),D=t("turf-within"),k=r(D),N=t("turf-featurecollection"),T=r(N),G="https://raw.githubusercontent.com/thadk/oc-map/master/data/topojson/owners-wBlighted-target-only.json",O="https://raw.githubusercontent.com/thadk/oc-map/master/data/topojson/DC_Boundary_Lines.json",L="https://raw.githubusercontent.com/thadk/oc-map/master/data/topojson/DC_Ward_Boundary_Lines.json",B="http://ggwash-forms.herokuapp.com/geocode",j={all:"See Properties ˃˃"},F=c["default"].createClass({displayName:"MapWidget",mapCountryLayer:null,layerStyles:{"default":{color:"#959595",weight:1,opacity:1,fillOpacity:1,fillColor:"#B5B5B5"},ggwashGreyGreen:{color:"#95ac9c",weight:3,opacity:1,fillOpacity:1,fillColor:"#0a9230"},ggwashGreenGrey:{color:"#0a9230",weight:2,opacity:1,fillOpacity:1,fillColor:"#95ac9c"},vacant:{color:"#C3670D",weight:1,opacity:1,fillOpacity:1,fillColor:"#C3670D"},blighted:{color:"#A30B53",weight:1,opacity:1,fillOpacity:1,fillColor:"#A30B53"},userVacant:{color:"#FF9F41",weight:1,opacity:.1,fillOpacity:1,fillColor:"#FF9F41"},nodata:{color:"#E3E3E3",weight:1,opacity:1,fillOpacity:1,fillColor:"#F4F4F4"},hover:{color:"#C2DC16",weight:1,opacity:1,fillOpacity:.5,fillColor:"#C2DC16"},active:{color:"#65ff11",weight:1,opacity:1,fillOpacity:1,fillColor:"#65ff11"},lilac:{color:"#6C75E1",weight:1,opacity:1,fillOpacity:1,fillColor:"#6C75E1"},orange:{color:"#FD843D",weight:1,opacity:1,fillOpacity:1,fillColor:"#FD843D"},teal:{color:"#23B2A7",weight:1,opacity:1,fillOpacity:1,fillColor:"#23B2A7"},darkorange:{color:"#FB6045",weight:1,opacity:1,fillOpacity:1,fillColor:"#FB6045"},blue:{color:"#6991F5",weight:1,opacity:1,fillOpacity:1,fillColor:"#6991F5"}},getInitialState:function(){return{fetchedData:!1,fetchingData:!1,mapTopoJSON:null,mapExtractedGeoJSON:null,mapCentroidsOfFeatures:null,dcBoundaryTopoJSON:null,mapTopoSW:null,mapTopoSE:null,mapTopoNW:null,mapTopoNE:null,godiScores:null,godiData:null,godiPlaces:null,featureCount:801,featureCountTotal:1212,activeCountryProperties:null,viewFilter:"all"}},fetchData:function(){var t=this;this.setState({fetchingData:!0}),n["default"].all([(0,s["default"])(G).then(function(t){if(t.status>=400)throw new Error("Bad response");return t.json()}),(0,s["default"])(O).then(function(t){if(t.status>=400)throw new Error("Bad response");return t.json()}),(0,s["default"])(L).then(function(t){if(t.status>=400)throw new Error("Bad response");return t.json()})]).then(function(e){var a=e[0],r=e[1],o=e[2];t.setState({fetchingData:!1,fetchedData:!0,mapTopoJSON:a,dcBoundaryTopoJSON:r,wardBoundaryTopoJSON:o}),t.setupMap()})},componentDidMount:function(){this.fetchData()},componentDidUpdate:function(){this.mapCountryLayer&&this.setCountriesStyle()},viewFilterClickHandler:function(t,e){e.preventDefault(),this.setState({viewFilter:t})},closeClickHandler:function(t){t.preventDefault(),this.setState({activeCountryProperties:null})},setCountriesStyle:function(){this.mapCountryLayer.eachLayer(this.setCountryStyle)},setCountryStyle:function(t){if(1===t.feature.properties.TYPE)return void t.setStyle(this.layerStyles.ggwashGreyGreen);if(0===t.feature.properties.TYPE)return void t.setStyle(this.layerStyles.ggwashGreenGrey);if(!t.feature.properties.GGStatus)return void t.setStyle(this.layerStyles.active);if(t.feature.properties.GGStatus%7===0||12===t.feature.properties.GGStatus)return void t.setStyle(this.layerStyles.blighted);if(5===t.feature.properties.GGStatus)return void t.setStyle(this.layerStyles.vacant);if(9===t.feature.properties.GGStatus)return void t.setStyle(this.layerStyles.userVacant);t.setStyle(this.layerStyles["default"]);var e=t.feature.properties;switch(this.state.viewFilter){case"ocds":m["default"].find(e.publishers,{ocds_ongoing_data:!0})?t.setStyle(this.layerStyles.lilac):m["default"].find(e.publishers,{ocds_historic_data:!0})?t.setStyle(this.layerStyles.orange):m["default"].find(e.publishers,{ocds_implementation:!0})&&t.setStyle(this.layerStyles.teal);break;case"commitments":e.ogp_commitments&&e.ogp_commitments.length&&t.setStyle(this.layerStyles.darkorange);break;case"contracts":e.innovations&&e.innovations.length&&t.setStyle(this.layerStyles.blue)}},onEachLayer:function(t){var e=this;this.setCountryStyle(t),t.on("click",function(a){t.feature.properties.GGStatus&&e.setState({activeCountryProperties:a.target.feature.properties})}).on("mousemove",function(a){t.feature.properties.GGStatus&&a.target.feature.properties.iso_a2!==m["default"].get(e.state.activeCountryProperties,"iso_a2","")&&a.target.setStyle(e.layerStyles.hover)}).on("mouseout",function(a){t.feature.properties.GGStatus&&a.target.feature.properties.iso_a2!==m["default"].get(e.state.activeCountryProperties,"iso_a2","")&&e.setCountryStyle(a.target)})},onMoveMap:function(t){var e=this.state.mapCentroidsOfFeatures,a=t.target.getBounds(),r=[a._southWest.lng,a._southWest.lat,a._northEast.lng,a._northEast.lat],o=(0,T["default"])([(0,C["default"])(r)]),s=(0,k["default"])(e,o);this.setState({featureCount:s.features.length,featureCountTotal:e.features.length})},setupMap:function(){function t(t,e){return n["default"].all([(0,s["default"])(B,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({str:t,f:"json"})}).then(function(t){if(t.status>=400)throw new Error("Bad response");return t.json()})]).then(function(t){var a=[];t[0].returnDataset&&t[0].returnDataset.Table1&&(a=t[0].returnDataset.Table1.map(function(t){return{loc:[t.LATITUDE,t.LONGITUDE],title:t.FULLADDRESS,SSL:t.SSL}})),e(a)})}var e=d["default"].map(this.refs.mapHolder).setView([38.9072,-77.0069],13),a=d["default"].tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'<a href="https://www.mapzen.com/rights">Attribution.</a>. Data &copy;<a href="https://openstreetmap.org/copyright">OSM</a> contributors.'});e.addLayer(a),e.on("move",this.onMoveMap);var r=d["default"].control({position:"bottomleft"});r.onAdd=function(t){return this._div=d["default"].DomUtil.create("div","info legend"),this.update(),this._div},r.update=function(t){this._div.innerHTML='<h4>DC Properties</h4><img src="https://raw.githubusercontent.com/thadk/oc-map/master/app/assets/images/ward.png" style="width: 10px; height: 10px"/> Ward boundary <br/><img src="https://raw.githubusercontent.com/thadk/oc-map/master/app/assets/images/vacant.png" style="width: 10px; height: 10px"/> DC Vacant <br/><img src="https://raw.githubusercontent.com/thadk/oc-map/master/app/assets/images/blighted.png" style="width: 10px; height: 10px"/> DC Blighted'},r.addTo(e),e.addControl(new d["default"].Control.Search({sourceData:t,text:"Color...",markerLocation:!0,circleLocation:!1,markerIcon:new d["default"].Icon({iconUrl:"https://raw.githubusercontent.com/thadk/oc-map/master/app/assets/images/marker-icon-highlight.png",iconSize:[25,41]})})),this.wardBoundaryLayer=g["default"].topojson.parse(this.state.wardBoundaryTopoJSON).eachLayer(this.onEachLayer).addTo(e),this.dcBoundaryLayer=g["default"].topojson.parse(this.state.dcBoundaryTopoJSON).eachLayer(this.onEachLayer).addTo(e),this.mapCountryLayer=g["default"].topojson.parse(this.state.mapTopoJSON).eachLayer(this.onEachLayer).addTo(e);var o=this.mapCountryLayer.toGeoJSON(),l=(0,T["default"])(o.features.map(function(t,e){return(0,E["default"])(t)}));this.setState({mapExtractedGeoJSON:o,mapCentroidsOfFeatures:l}),this.onMoveMap({target:e})},renderGGWash:function(t){var e=[];if(t.GGStatus%5===0||12===t.GGStatus){var a="Was marked as Vacant by DC in late 2015";e.push(c["default"].createElement("li",{key:"vacant"},a))}else if(t.GGStatus%7===0){var r="Was marked as Blighted by DC in late 2015";e.push(c["default"].createElement("li",{key:"blighted"},r))}return e.push(c["default"].createElement("li",{key:"addy"},"Address: ",t.PREMISEADD)),c["default"].createElement("div",null,c["default"].createElement("h3",null,"Vacant/Blighted Property"),c["default"].createElement("ul",null,e))},render:function(){var t=this;if(!this.state.fetchedData&&!this.state.fetchingData)return null;var e=this.state.activeCountryProperties;return c["default"].createElement("section",{className:"ocp-map"},c["default"].createElement("header",{className:"ocp-map__header"},c["default"].createElement("h1",{className:"ocp-map__title"},"GGWash Vacant/Blight Map"),c["default"].createElement("div",{className:"ocp-map__actions"},c["default"].createElement("div",{className:"pull-right"},this.state.featureCount," of ",this.state.featureCountTotal," showing"),c["default"].createElement("span",{className:"ocp-map__actions-description"},"View to:"),c["default"].createElement(v["default"],{element:"span",className:"drop drop--down drop--align-left",triggerTitle:"View map by",triggerText:j[this.state.viewFilter],triggerClassName:"drop__toggle"},c["default"].createElement("ul",{className:"drop__menu drop__menu--select"},m["default"].map(j,function(e,a){return c["default"].createElement("li",{key:a},c["default"].createElement("a",{href:"",className:(0,f["default"])("drop__menu-item",{"drop__menu-item--active":t.state.viewFilter===a}),"data-hook":"dropdown:close",onClick:t.viewFilterClickHandler.bind(null,a)},e))}))))),c["default"].createElement("div",{className:"ocp-map__body"},c["default"].createElement("div",{className:"ocp-map__map",ref:"mapHolder"}),c["default"].createElement("div",{className:(0,f["default"])("ocp-map__content-wrapper",{"ocp-revealed":null!==e})},null!==e?c["default"].createElement("div",{className:"ocp-map__content"},c["default"].createElement("a",{href:"#",className:"ocp-map__button-close",onClick:this.closeClickHandler},c["default"].createElement("span",null,"Close map content")),this.renderGGWash(e)):null)))}});e.exports=F},{"../components/dropdown":"/Users/thadk/gitrepos/oc-map/app/assets/scripts/components/dropdown.js",bluebird:"bluebird",classnames:"classnames","isomorphic-fetch":"isomorphic-fetch",leaflet:"leaflet","leaflet-omnivore":"leaflet-omnivore","leaflet-search":"leaflet-search",lodash:"lodash",react:"react","turf-bbox-polygon":"turf-bbox-polygon","turf-centroid":"turf-centroid","turf-featurecollection":"turf-featurecollection","turf-within":"turf-within"}],"/Users/thadk/gitrepos/oc-map/app/assets/scripts/views/table-widget.js":[function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var o=t("react"),s=r(o),l=t("isomorphic-fetch"),n=r(l),i=t("lodash"),c=r(i),u=t("classnames"),d=r(u),p=s["default"].createClass({displayName:"TableWidget",getInitialState:function(){return{fetchedData:!1,fetchingData:!1,sort:{field:"country",order:"asc"},data:{}}},fetchData:function(){var t=this;this.setState({fetchingData:!0}),(0,n["default"])("https://raw.githubusercontent.com/open-contracting-partnership/ocp-data/publish/oc-status/_table.json").then(function(t){return t.json()}).then(function(e){t.setState({fetchingData:!1,fetchedData:!0,data:e})})},componentDidMount:function(){this.fetchData()},sortLinkClickHandler:function(t,e){e.preventDefault();var a=this.state.sort,r=a.field,o=a.order,s="asc";r===t&&(s="asc"===o?"desc":"asc"),this.setState({sort:{field:t,order:s}})},renderTableHead:function(){var t=this;return s["default"].createElement("thead",null,s["default"].createElement("tr",null,c["default"].map(this.state.data.meta.display,function(e){var a=(0,d["default"])("sort",{"sort--none":t.state.sort.field!==e.key,"sort--asc":t.state.sort.field===e.key&&"asc"===t.state.sort.order,"sort--desc":t.state.sort.field===e.key&&"desc"===t.state.sort.order});return s["default"].createElement("th",{key:e.key},s["default"].createElement("a",{href:"",className:a,onClick:t.sortLinkClickHandler.bind(null,e.key)},e.value))})))},renderTableBody:function(){var t=this,e=(0,c["default"])(this.state.data.data).sortBy(this.state.sort.field);return"desc"===this.state.sort.order&&(e=e.reverse()),e=e.value(),s["default"].createElement("tbody",null,c["default"].map(e,function(e,a){return s["default"].createElement("tr",{key:"tr-"+a+"-"+c["default"].kebabCase(e.country)},c["default"].map(t.state.data.meta.display,function(t){return s["default"].createElement("td",{key:"tr-"+a+"-td-"+c["default"].kebabCase(t.key)},e[t.key])}))}))},render:function(){return this.state.fetchedData||this.state.fetchingData?s["default"].createElement("section",{className:"ocp-table"},s["default"].createElement("header",{className:"ocp-table__header"},s["default"].createElement("h1",{className:"ocp-table__title"},"Open Contracting Table")),s["default"].createElement("div",{className:"ocp-table__body"},this.state.fetchingData?s["default"].createElement("p",null,"Loading data..."):s["default"].createElement("table",{className:"ocp-table__table"},this.renderTableHead(),this.renderTableBody()))):null}});e.exports=p},{classnames:"classnames","isomorphic-fetch":"isomorphic-fetch",lodash:"lodash",react:"react"}]},{},["/Users/thadk/gitrepos/oc-map/app/assets/scripts/main.js"]);